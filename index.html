<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sistema Solar VR</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { margin: 0; padding: 0; background: #000; font-family: Arial, sans-serif; overflow: hidden; touch-action: none; user-select: none; -webkit-user-select: none; position: fixed; width: 100%; height: 100vh; }
        
        #info { position: absolute; top: 10px; left: 10px; color: white; background: rgba(0,0,0,0.8); padding: 12px; border-radius: 8px; z-index: 100; max-width: 280px; font-size: 13px; }
        
        .button { position: absolute; bottom: 15px; padding: 10px 20px; color: white; border: none; border-radius: 20px; cursor: pointer; font-size: 14px; font-weight: bold; z-index: 100; transition: all 0.3s; touch-action: manipulation; }
        #vr-button { right: 15px; background: #4CAF50; }
        #stereo-button { right: 160px; background: #9C27B0; }
        #pause-button { left: 50%; transform: translateX(-50%); background: #FF9800; }
        
        .button:active { transform: scale(0.95); }
        .vr-mode { background: linear-gradient(45deg, #FF4757, #FF6B6B) !important; }
        .stereo-mode { background: linear-gradient(45deg, #9C27B0, #E91E63) !important; }
        .paused { background: #2196F3 !important; }
        
        .eye-container { position: absolute; top: 0; width: 50%; height: 100%; display: none; }
        .eye-container.active { display: block; }
        #left-eye { left: 0; }
        #right-eye { right: 0; }
        
        .stereo-divider { position: absolute; left: 50%; top: 0; width: 3px; height: 100%; background: #222; z-index: 50; display: none; }
        .stereo-divider.active { display: block; }
        
        .joystick-container { display: none; position: absolute; bottom: 80px; left: 15px; width: 110px; height: 110px; z-index: 100; }
        .joystick-container.active { display: block; }
        .joystick-base { width: 110px; height: 110px; border-radius: 50%; background: rgba(255, 255, 255, 0.15); border: 4px solid rgba(255, 255, 255, 0.4); position: absolute; }
        .joystick-stick { width: 45px; height: 45px; border-radius: 50%; background: rgba(156, 39, 176, 0.9); border: 4px solid rgba(156, 39, 176, 1); position: absolute; top: 32.5px; left: 32.5px; transition: none; box-shadow: 0 0 15px rgba(156, 39, 176, 0.5); }
        
        .action-buttons { display: none; position: absolute; bottom: 80px; right: 15px; z-index: 100; flex-direction: column; gap: 12px; }
        .action-buttons.active { display: flex; }
        .action-btn { width: 55px; height: 55px; border-radius: 50%; background: rgba(156, 39, 176, 0.9); border: 4px solid rgba(156, 39, 176, 1); color: white; font-size: 20px; display: flex; align-items: center; justify-content: center; touch-action: manipulation; font-weight: bold; box-shadow: 0 0 15px rgba(156, 39, 176, 0.5); }
        
        #vr-instructions { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0, 0, 0, 0.95); color: white; padding: 25px; border-radius: 15px; z-index: 200; text-align: center; display: none; max-width: 85%; border: 2px solid #9C27B0; }
        #vr-instructions.visible { display: block; }
        #vr-instructions h2 { color: #9C27B0; margin: 0 0 15px 0; font-size: 20px; }
        #vr-instructions p { margin: 8px 0; font-size: 14px; line-height: 1.5; }
        #vr-instructions button { margin-top: 20px; padding: 12px 30px; background: #9C27B0; color: white; border: none; border-radius: 25px; cursor: pointer; font-size: 16px; font-weight: bold; box-shadow: 0 4px 15px rgba(156, 39, 176, 0.4); }
        
        .vr-crosshair { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 6px; height: 6px; background: white; border-radius: 50%; z-index: 50; opacity: 0; transition: opacity 0.3s; box-shadow: 0 0 15px white; }
        .vr-crosshair.active { opacity: 0.8; }
        
        #orientation-prompt { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(156, 39, 176, 0.95); color: white; padding: 30px; border-radius: 15px; z-index: 250; text-align: center; display: none; }
        #orientation-prompt.visible { display: block; }
        #orientation-prompt button { margin-top: 15px; padding: 12px 30px; background: white; color: #9C27B0; border: none; border-radius: 25px; cursor: pointer; font-size: 16px; font-weight: bold; }
        
        @media (max-width: 768px) {
            #stereo-button { bottom: 70px; right: 15px; }
            #info { font-size: 11px; padding: 8px; max-width: 200px; }
        }
    </style>
</head>
<body>
    <div id="info">
        <h3 style="margin: 0 0 8px 0;">üöÄ Sistema Solar VR</h3>
        <p><strong>Desktop:</strong> Mouse</p>
        <p><strong>VR √ìculos:</strong> Girosc√≥pio + Joystick</p>
    </div>
    
    <div id="orientation-prompt">
        <h2 style="margin: 0 0 10px 0;">üì± Permiss√£o Necess√°ria</h2>
        <p>Para usar o girosc√≥pio do VR, precisamos de permiss√£o.</p>
        <button onclick="grantOrientation()">Permitir Girosc√≥pio</button>
    </div>
    
    <div id="vr-instructions">
        <h2>ü•Ω VR Estereosc√≥pico Ativado!</h2>
        <p><strong>‚úì</strong> Coloque o celular nos √≥culos VR</p>
        <p><strong>‚úì</strong> Mova a cabe√ßa para olhar 360¬∞</p>
        <p><strong>‚úì</strong> Joystick para navegar pelo espa√ßo</p>
        <p><strong>‚úì</strong> Bot√µes ‚Üë‚Üì para subir/descer</p>
        <button onclick="closeInstructions()">Come√ßar Agora!</button>
    </div>
    
    <div id="main-container"></div>
    <div id="left-eye" class="eye-container"></div>
    <div id="right-eye" class="eye-container"></div>
    <div class="stereo-divider" id="stereo-divider"></div>
    
    <div class="joystick-container" id="joystick">
        <div class="joystick-base"></div>
        <div class="joystick-stick" id="joystick-stick"></div>
    </div>
    
    <div class="action-buttons" id="action-buttons">
        <div class="action-btn" id="btn-up">‚Üë</div>
        <div class="action-btn" id="btn-down">‚Üì</div>
    </div>
    
    <button class="button" id="stereo-button">ü•Ω VR √ìculos</button>
    <button class="button" id="vr-button">üéÆ VR Simulado</button>
    <button class="button" id="pause-button">‚è∏Ô∏è Pausar</button>
    <div class="vr-crosshair" id="crosshair"></div>

    <script>
        let scene, camera, renderer, cameraLeft, cameraRight, rendererLeft, rendererRight;
        let planets = [], sun;
        let vrMode = false, stereoMode = false, isPaused = false;
        let moveSpeed = 0.2;
        let keys = {};
        let eyeSeparation = 0.064;
        let joystickActive = false, joystickVector = { x: 0, y: 0 };
        let orientationPermission = false;

        init();
        animate();

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 5, 20);
            
            const aspect = window.innerWidth / (2 * window.innerHeight);
            cameraLeft = new THREE.PerspectiveCamera(75, aspect, 0.1, 1000);
            cameraRight = new THREE.PerspectiveCamera(75, aspect, 0.1, 1000);
            cameraLeft.position.set(0, 5, 20);
            cameraRight.position.set(0, 5, 20);
            
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            document.getElementById('main-container').appendChild(renderer.domElement);
            
            rendererLeft = new THREE.WebGLRenderer({ antialias: true });
            rendererRight = new THREE.WebGLRenderer({ antialias: true });
            rendererLeft.setSize(window.innerWidth / 2, window.innerHeight);
            rendererRight.setSize(window.innerWidth / 2, window.innerHeight);
            rendererLeft.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            rendererRight.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            document.getElementById('left-eye').appendChild(rendererLeft.domElement);
            document.getElementById('right-eye').appendChild(rendererRight.domElement);
            
            setupButtons();
            setupMobileControls();
            createSolarSystem();
            addLights();
            addMouseControls();
            
            window.addEventListener('resize', onWindowResize);
        }

        function setupButtons() {
            document.getElementById('vr-button').onclick = toggleSimulatedVR;
            document.getElementById('stereo-button').onclick = toggleStereoVR;
            document.getElementById('pause-button').onclick = () => {
                isPaused = !isPaused;
                const btn = document.getElementById('pause-button');
                btn.textContent = isPaused ? '‚ñ∂Ô∏è Continuar' : '‚è∏Ô∏è Pausar';
                btn.classList.toggle('paused');
            };
        }
        
        function setupMobileControls() {
            const joystick = document.getElementById('joystick');
            const stick = document.getElementById('joystick-stick');
            
            joystick.addEventListener('touchstart', (e) => { 
                e.preventDefault(); 
                joystickActive = true; 
            }, { passive: false });
            
            joystick.addEventListener('touchmove', (e) => {
                if (!joystickActive) return;
                e.preventDefault();
                
                const touch = e.touches[0];
                const rect = joystick.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                let deltaX = touch.clientX - centerX;
                let deltaY = touch.clientY - centerY;
                const maxDistance = 35;
                const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                if (distance > maxDistance) {
                    deltaX = (deltaX / distance) * maxDistance;
                    deltaY = (deltaY / distance) * maxDistance;
                }
                joystickVector.x = deltaX / maxDistance;
                joystickVector.y = deltaY / maxDistance;
                stick.style.transform = `translate(${deltaX}px, ${deltaY}px)`;
            }, { passive: false });
            
            joystick.addEventListener('touchend', (e) => {
                e.preventDefault();
                joystickActive = false;
                joystickVector = { x: 0, y: 0 };
                stick.style.transform = 'translate(0, 0)';
            }, { passive: false });
            
            const btnUp = document.getElementById('btn-up');
            const btnDown = document.getElementById('btn-down');
            
            btnUp.addEventListener('touchstart', (e) => { e.preventDefault(); keys['Space'] = true; }, { passive: false });
            btnUp.addEventListener('touchend', (e) => { e.preventDefault(); keys['Space'] = false; }, { passive: false });
            btnDown.addEventListener('touchstart', (e) => { e.preventDefault(); keys['ShiftLeft'] = true; }, { passive: false });
            btnDown.addEventListener('touchend', (e) => { e.preventDefault(); keys['ShiftLeft'] = false; }, { passive: false });
        }
        
        function grantOrientation() {
            requestOrientationPermission();
            document.getElementById('orientation-prompt').classList.remove('visible');
        }
        
        async function requestOrientationPermission() {
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                try {
                    const permission = await DeviceOrientationEvent.requestPermission();
                    if (permission === 'granted') {
                        orientationPermission = true;
                        setupDeviceOrientation();
                    }
                } catch (error) {
                    orientationPermission = true;
                    setupDeviceOrientation();
                }
            } else {
                orientationPermission = true;
                setupDeviceOrientation();
            }
        }
        
        function setupDeviceOrientation() {
            window.addEventListener('deviceorientation', (event) => {
                if (!stereoMode || !event.alpha) return;
                
                const alpha = THREE.MathUtils.degToRad(event.alpha || 0);
                const beta = THREE.MathUtils.degToRad(event.beta || 0);
                const gamma = THREE.MathUtils.degToRad(event.gamma || 0);
                
                const zee = new THREE.Vector3(0, 0, 1);
                const euler = new THREE.Euler();
                const q0 = new THREE.Quaternion();
                const q1 = new THREE.Quaternion(-Math.sqrt(0.5), 0, 0, Math.sqrt(0.5));
                
                euler.set(beta, alpha, -gamma, 'YXZ');
                const quat = new THREE.Quaternion();
                quat.setFromEuler(euler);
                quat.multiply(q1);
                quat.multiply(q0.setFromAxisAngle(zee, 0));
                
                cameraLeft.quaternion.copy(quat);
                cameraRight.quaternion.copy(quat);
            }, true);
        }
        
        function closeInstructions() { 
            document.getElementById('vr-instructions').classList.remove('visible'); 
        }
        
        function toggleStereoVR() {
            if (vrMode) toggleSimulatedVR();
            stereoMode = !stereoMode;
            const btn = document.getElementById('stereo-button');
            
            if (stereoMode) {
                btn.textContent = 'üö™ Sair VR';
                btn.classList.add('stereo-mode');
                document.getElementById('main-container').style.display = 'none';
                document.getElementById('left-eye').classList.add('active');
                document.getElementById('right-eye').classList.add('active');
                document.getElementById('stereo-divider').classList.add('active');
                document.getElementById('info').style.display = 'none';
                document.getElementById('joystick').classList.add('active');
                document.getElementById('action-buttons').classList.add('active');
                
                const basePos = new THREE.Vector3(0, 5, 20);
                cameraLeft.position.copy(basePos);
                cameraRight.position.copy(basePos);
                
                if (!orientationPermission) {
                    if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                        document.getElementById('orientation-prompt').classList.add('visible');
                    } else {
                        requestOrientationPermission();
                    }
                }
                
            } else {
                btn.textContent = 'ü•Ω VR √ìculos';
                btn.classList.remove('stereo-mode');
                document.getElementById('main-container').style.display = 'block';
                document.getElementById('left-eye').classList.remove('active');
                document.getElementById('right-eye').classList.remove('active');
                document.getElementById('stereo-divider').classList.remove('active');
                document.getElementById('info').style.display = 'block';
                document.getElementById('joystick').classList.remove('active');
                document.getElementById('action-buttons').classList.remove('active');
                document.getElementById('vr-instructions').classList.remove('visible');
                camera.position.set(0, 5, 20);
                camera.lookAt(0, 0, 0);
            }
        }
        
        function updateStereoMovement() {
            if (!stereoMode) return;
            
            const direction = new THREE.Vector3(0, 0, -1);
            direction.applyQuaternion(cameraLeft.quaternion);
            const basePos = cameraLeft.position.clone();
            
            if (joystickVector.x !== 0 || joystickVector.y !== 0) {
                const forward = direction.clone();
                forward.y = 0;
                forward.normalize();
                forward.multiplyScalar(-joystickVector.y * moveSpeed);
                basePos.add(forward);
                
                const right = new THREE.Vector3();
                right.crossVectors(direction, new THREE.Vector3(0, 1, 0));
                right.normalize();
                right.multiplyScalar(joystickVector.x * moveSpeed);
                basePos.add(right);
            }
            
            if (keys['Space']) basePos.y += moveSpeed * 0.8;
            if (keys['ShiftLeft']) basePos.y -= moveSpeed * 0.8;
            
            const offset = new THREE.Vector3(eyeSeparation / 2, 0, 0);
            offset.applyQuaternion(cameraLeft.quaternion);
            
            cameraLeft.position.copy(basePos).sub(offset);
            cameraRight.position.copy(basePos).add(offset);
        }

        function toggleSimulatedVR() {
            if (stereoMode) toggleStereoVR();
            vrMode = !vrMode;
            const btn = document.getElementById('vr-button');
            
            if (vrMode) {
                btn.textContent = 'üö™ Sair VR';
                btn.classList.add('vr-mode');
                document.getElementById('crosshair').classList.add('active');
                document.getElementById('info').style.opacity = '0.3';
                camera.position.set(0, 2, 15);
                document.addEventListener('keydown', onKeyDown);
                document.addEventListener('keyup', onKeyUp);
                document.addEventListener('mousemove', onVRMouseMove);
                document.addEventListener('click', () => {
                    if (document.body.requestPointerLock) document.body.requestPointerLock();
                });
            } else {
                btn.textContent = 'üéÆ VR Simulado';
                btn.classList.remove('vr-mode');
                document.getElementById('crosshair').classList.remove('active');
                document.getElementById('info').style.opacity = '1';
                document.removeEventListener('keydown', onKeyDown);
                document.removeEventListener('keyup', onKeyUp);
                document.removeEventListener('mousemove', onVRMouseMove);
                if (document.exitPointerLock) document.exitPointerLock();
                camera.position.set(0, 5, 20);
                camera.rotation.set(0, 0, 0);
            }
        }

        function onKeyDown(e) { keys[e.code] = true; }
        function onKeyUp(e) { keys[e.code] = false; }

        function onVRMouseMove(e) {
            if (!vrMode) return;
            camera.rotation.y -= (e.movementX || 0) * 0.002;
            camera.rotation.x -= (e.movementY || 0) * 0.002;
            camera.rotation.x = Math.max(-Math.PI/2, Math.min(Math.PI/2, camera.rotation.x));
        }

        function updateVRMovement() {
            if (!vrMode) return;
            const dir = new THREE.Vector3();
            if (keys['KeyW']) { camera.getWorldDirection(dir); camera.position.add(dir.multiplyScalar(moveSpeed)); }
            if (keys['KeyS']) { camera.getWorldDirection(dir); camera.position.add(dir.multiplyScalar(-moveSpeed)); }
            if (keys['KeyA']) { camera.getWorldDirection(dir); const left = new THREE.Vector3().crossVectors(camera.up, dir); camera.position.add(left.normalize().multiplyScalar(moveSpeed)); }
            if (keys['KeyD']) { camera.getWorldDirection(dir); const right = new THREE.Vector3().crossVectors(dir, camera.up); camera.position.add(right.normalize().multiplyScalar(moveSpeed)); }
            if (keys['Space']) camera.position.y += moveSpeed;
            if (keys['ShiftLeft']) camera.position.y -= moveSpeed;
        }

        function createSolarSystem() {
            createStarField();
            const sunGeo = new THREE.SphereGeometry(2, 32, 32);
            const sunMat = new THREE.MeshBasicMaterial({ color: 0xFFD700, emissive: 0xFFAA00 });
            sun = new THREE.Mesh(sunGeo, sunMat);
            scene.add(sun);
            
            const planetData = [
                { name: 'Merc√∫rio', size: 0.3, distance: 4, color: 0x8C7853, speed: 0.01 },
                { name: 'V√™nus', size: 0.5, distance: 6, color: 0xFFA500, speed: 0.0075 },
                { name: 'Terra', size: 0.6, distance: 8, color: 0x4169E1, speed: 0.005, hasMoon: true },
                { name: 'Marte', size: 0.4, distance: 10, color: 0xFF4500, speed: 0.004 },
                { name: 'J√∫piter', size: 1.2, distance: 15, color: 0xDAA520, speed: 0.0025 },
                { name: 'Saturno', size: 1.0, distance: 18, color: 0xFAD5A5, speed: 0.002, hasRings: true }
            ];
            
            planetData.forEach(data => { planets.push(createPlanet(data)); scene.add(planets[planets.length - 1].group); });
        }

        function createPlanet(data) {
            const group = new THREE.Group();
            const orbitGeo = new THREE.RingGeometry(data.distance - 0.1, data.distance + 0.1, 64);
            const orbitMat = new THREE.MeshBasicMaterial({ color: 0x444444, side: THREE.DoubleSide, transparent: true, opacity: 0.3 });
            const orbit = new THREE.Mesh(orbitGeo, orbitMat);
            orbit.rotation.x = -Math.PI / 2;
            group.add(orbit);
            
            const planetGeo = new THREE.SphereGeometry(data.size, 32, 32);
            const planetMat = new THREE.MeshLambertMaterial({ color: data.color });
            const planetMesh = new THREE.Mesh(planetGeo, planetMat);
            planetMesh.position.x = data.distance;
            group.add(planetMesh);
            
            if (data.hasMoon) {
                const moonGeo = new THREE.SphereGeometry(data.size * 0.27, 16, 16);
                const moonMat = new THREE.MeshLambertMaterial({ color: 0xAAAAAA });
                const moon = new THREE.Mesh(moonGeo, moonMat);
                moon.position.x = data.size * 2;
                planetMesh.add(moon);
            }
            
            if (data.hasRings) {
                const ringGeo = new THREE.RingGeometry(data.size * 1.2, data.size * 1.8, 32);
                const ringMat = new THREE.MeshLambertMaterial({ color: 0xC4A484, side: THREE.DoubleSide, transparent: true, opacity: 0.7 });
                const ring = new THREE.Mesh(ringGeo, ringMat);
                ring.rotation.x = -Math.PI / 2;
                planetMesh.add(ring);
            }
            
            return { group: group, planet: planetMesh, data: data, angle: Math.random() * Math.PI * 2 };
        }

        function createStarField() {
            const starGeo = new THREE.BufferGeometry();
            const positions = new Float32Array(30000);
            for (let i = 0; i < 30000; i++) positions[i] = (Math.random() - 0.5) * 2000;
            starGeo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            const stars = new THREE.Points(starGeo, new THREE.PointsMaterial({ color: 0xFFFFFF, size: 0.5 }));
            scene.add(stars);
        }

        function addLights() {
            const sunLight = new THREE.PointLight(0xFFFFFF, 2, 100);
            sunLight.castShadow = true;
            scene.add(sunLight);
            scene.add(new THREE.AmbientLight(0x404040, 0.1));
        }

        function addMouseControls() {
            document.addEventListener('mousemove', (e) => {
                if (!vrMode && !stereoMode) {
                    const mx = (e.clientX / window.innerWidth) * 2 - 1;
                    const my = -(e.clientY / window.innerHeight) * 2 + 1;
                    camera.position.x = Math.sin(mx * Math.PI) * 25;
                    camera.position.z = Math.cos(mx * Math.PI) * 25;
                    camera.position.y = my * 10 + 5;
                    camera.lookAt(0, 0, 0);
                }
            });
            
            document.addEventListener('wheel', (e) => {
                if (!vrMode && !stereoMode) {
                    const dist = camera.position.length();
                    const newDist = Math.max(5, Math.min(50, dist + e.deltaY * 0.01));
                    camera.position.normalize().multiplyScalar(newDist);
                }
            });
        }

        function animate() {
            requestAnimationFrame(animate);
            updateVRMovement();
            updateStereoMovement();
            
            if (!isPaused) {
                sun.rotation.y += 0.002;
                planets.forEach(p => {
                    p.angle += p.data.speed;
                    p.planet.position.x = Math.cos(p.angle) * p.data.distance;
                    p.planet.position.z = Math.sin(p.angle) * p.data.distance;
                    p.planet.rotation.y += 0.005;
                });
            }
            
            if (stereoMode) {
                rendererLeft.render(scene, cameraLeft);
                rendererRight.render(scene, cameraRight);
            } else {
                renderer.render(scene, camera);
            }
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            
            const aspect = window.innerWidth / (2 * window.innerHeight);
            cameraLeft.aspect = aspect;
            cameraRight.aspect = aspect;
            cameraLeft.updateProjectionMatrix();
            cameraRight.updateProjectionMatrix();
            
            if (stereoMode) {
                rendererLeft.setSize(window.innerWidth / 2, window.innerHeight);
                rendererRight.setSize(window.innerWidth / 2, window.innerHeight);
            }
        }
    </script>
</body>
</html>
