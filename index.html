<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>Sistema Solar VR</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #000; overflow: hidden; }

        #info {
            position: absolute; top: 10px; left: 10px;
            color: white; background: rgba(0,0,0,0.7);
            padding: 10px; border-radius: 8px;
            font-size: 13px; z-index: 50;
        }

        #planet-info {
            position: absolute; top: 10px; left: 50%; transform: translateX(-50%);
            color: white; background: rgba(0,0,0,0.85);
            padding: 12px; border-radius: 10px;
            display: none; z-index: 60; width: 90%; max-width: 400px;
            border: 2px solid #4CAF50; font-size: 11px;
        }
        #planet-info h2 { margin: 0 0 6px 0; color: #4CAF50; font-size: 14px; text-align: center; }

        #vr-button {
            position: absolute; bottom: 20px; right: 20px;
            padding: 12px 24px; color: white; border: none;
            border-radius: 25px; cursor: pointer; z-index: 100;
            background: linear-gradient(135deg, #667eea, #764ba2);
            font-weight: bold; font-size: 15px;
        }

        #vr-button.active { background: linear-gradient(135deg, #ff416c, #ff4b2b); }

        #vr-overlay {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9); padding: 25px;
            color: white; border-radius: 15px; border: 2px solid #667eea;
            display: none; text-align: center; max-width: 90%; z-index: 200;
        }
        #vr-overlay.visible { display: block; }
    </style>
</head>
<body>
    <div id="info">
        <h3>Sistema Solar VR üåç</h3>
        <p>‚Ä¢ Arraste a tela para girar a c√¢mera</p>
        <p>‚Ä¢ Fa√ßa zoom com pin√ßa</p>
        <p>‚Ä¢ Toque no bot√£o para entrar no modo VR Real</p>
    </div>

    <div id="planet-info">
        <h2 id="planet-name"></h2>
        <p id="planet-description"></p>
        <p id="planet-distance"></p>
        <p id="planet-size"></p>
        <p id="planet-orbital"></p>
        <p id="planet-day"></p>
        <p id="planet-moons"></p>
        <p id="planet-curiosity"></p>
    </div>

    <button id="vr-button" disabled>üîç Verificando VR...</button>

    <div id="vr-overlay">
        <h2>Iniciando VR...</h2>
        <p id="vr-message">Aguarde‚Ä¶</p>
    </div>

    <script>
        let scene, camera, renderer, sun;
        let planets = [];
        let raycaster = new THREE.Raycaster();
        let pointer = new THREE.Vector2();
        let vrSession = null;
        let isVRMode = false;
        let planetInfoTimer = null;

        init();
        animate();

        async function init() {

            scene = new THREE.Scene();

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);
            camera.position.set(0, 15, 40);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.xr.enabled = true;
            document.body.appendChild(renderer.domElement);

            await checkVRSupport();
            setupButtons();

            createSolarSystem();
            createStars();
            addLights();

            window.addEventListener("resize", onResize);

            setupTouchCamera();
        }

        async function checkVRSupport() {
            const btn = document.getElementById("vr-button");

            if (!navigator.xr) {
                btn.textContent = "‚ùå VR n√£o suportado";
                btn.disabled = true;
                return;
            }

            const supported = await navigator.xr.isSessionSupported("immersive-vr");
            if (supported) {
                btn.textContent = "ü•Ω Entrar VR";
                btn.disabled = false;
            } else {
                btn.textContent = "‚ùå VR indispon√≠vel";
                btn.disabled = true;
            }
        }

        function setupButtons() {
            document.getElementById("vr-button").onclick = toggleVR;
        }

        async function toggleVR() {
            if (vrSession) {
                vrSession.end();
                return;
            }

            showVROverlay("Conectando ao VR‚Ä¶");

            try {
                vrSession = await navigator.xr.requestSession("immersive-vr");
                await renderer.xr.setSession(vrSession);

                isVRMode = true;

                document.getElementById("vr-button").classList.add("active");
                document.getElementById("vr-button").textContent = "üö™ Sair VR";
                hideInfo();

                vrSession.addEventListener("end", () => {
                    isVRMode = false;
                    vrSession = null;
                    document.getElementById("vr-overlay").style.display = "none";
                    document.getElementById("vr-button").textContent = "ü•Ω Entrar VR";
                    document.getElementById("vr-button").classList.remove("active");
                    showInfo();
                });

                hideVROverlayAfter(2000);

            } catch (e) {
                console.error(e);
                showVROverlay("Erro ao iniciar VR");
                hideVROverlayAfter(3000);
            }
        }

        function showInfo() {
            document.getElementById("info").style.display = "block";
        }
        function hideInfo() {
            document.getElementById("info").style.display = "none";
        }

        function showVROverlay(msg) {
            document.getElementById("vr-message").textContent = msg;
            document.getElementById("vr-overlay").classList.add("visible");
        }
        function hideVROverlayAfter(ms) {
            setTimeout(() => {
                document.getElementById("vr-overlay").classList.remove("visible");
            }, ms);
        }

        /* ------------------------ SOLAR SYSTEM ------------------------ */

        function createSolarSystem() {
            const sunGeo = new THREE.SphereGeometry(3, 32, 32);
            const sunMat = new THREE.MeshBasicMaterial({ color: 0xffd700 });
            sun = new THREE.Mesh(sunGeo, sunMat);
            sun.userData = {
                name: 'Sol', description: 'A estrela central',
                realDistance: 'Centro', realSize: '1.392.700 km',
                orbitalPeriod: '-', dayLength: '25 dias',
                moons: '8 planetas', curiosity: 'Cont√©m 99,8% da massa'
            };
            scene.add(sun);

            const planetData = [
                { name: 'Merc√∫rio', size: 0.5, distance: 6, color: 0x8C7853, speed: 0.01, 
                  desc: 'Menor planeta', dist: '57,9 mi km', sizeReal: '4.879 km',
                  orbital: '88 dias', day: '59 dias', moons: '0',
                  cur: 'Temperaturas extremas' },

                { name: 'V√™nus', size: 0.8, distance: 9, color: 0xFFA500, speed: 0.0075,
                  desc: 'Planeta mais quente', dist: '108 mi km', sizeReal: '12.104 km',
                  orbital: '225 dias', day: '243 dias', moons: '0',
                  cur: 'Efeito estufa extremo' },

                { name: 'Terra', size: 0.9, distance: 12, color: 0x4169E1, speed: 0.005,
                  desc: 'Nosso lar', dist: '149 mi km', sizeReal: '12.742 km',
                  orbital: '365 dias', day: '24h', moons: '1',
                  cur: '70% da superf√≠cie √© √°gua' },

                { name: 'Marte', size: 0.6, distance: 15, color: 0xFF4500, speed: 0.004,
                  desc: 'Planeta vermelho', dist: '227 mi km', sizeReal: '6.779 km',
                  orbital: '687 dias', day: '24,6h', moons: '2',
                  cur: 'Possui o maior vulc√£o' }
            ];

            planetData.forEach(data => {
                const geo = new THREE.SphereGeometry(data.size, 32, 32);
                const mat = new THREE.MeshLambertMaterial({ color: data.color });
                const mesh = new THREE.Mesh(geo, mat);

                mesh.position.x = data.distance;
                mesh.userData = {
                    name: data.name,
                    description: data.desc,
                    realDistance: data.dist,
                    realSize: data.sizeReal,
                    orbitalPeriod: data.orbital,
                    dayLength: data.day,
                    moons: data.moons,
                    curiosity: data.cur
                };

                scene.add(mesh);

                planets.push({
                    mesh,
                    angle: Math.random() * Math.PI * 2,
                    speed: data.speed,
                    distance: data.distance
                });
            });
        }

        function createStars() {
            const starGeo = new THREE.BufferGeometry();
            const starCount = 20000;
            const positions = new Float32Array(starCount * 3);

            for (let i = 0; i < starCount * 3; i++) {
                positions[i] = (Math.random() - 0.5) * 2000;
            }

            starGeo.setAttribute("position", new THREE.BufferAttribute(positions, 3));
            const mat = new THREE.PointsMaterial({ color: 0xffffff, size: 0.7 });
            const stars = new THREE.Points(starGeo, mat);
            scene.add(stars);
        }

        function addLights() {
            const sunLight = new THREE.PointLight(0xffffff, 2.5, 200);
            scene.add(sunLight);
            scene.add(new THREE.AmbientLight(0xffffff, 0.2));
        }

        /* ------------------------ TOUCH CAMERA ------------------------ */

        let isTouching = false;
        let touchX = 0, touchY = 0;
        let rotX = 0, rotY = 0;

        function setupTouchCamera() {
            document.addEventListener("touchstart", e => {
                isTouching = true;
                touchX = e.touches[0].clientX;
                touchY = e.touches[0].clientY;
            });

            document.addEventListener("touchmove", e => {
                if (!isTouching) return;

                const dx = e.touches[0].clientX - touchX;
                const dy = e.touches[0].clientY - touchY;

                rotY -= dx * 0.002;
                rotX -= dy * 0.002;

                rotX = Math.max(-1.2, Math.min(1.2, rotX));

                camera.position.x = Math.sin(rotY) * 40;
                camera.position.z = Math.cos(rotY) * 40;
                camera.position.y = rotX * 15 + 15;

                camera.lookAt(0, 0, 0);

                touchX = e.touches[0].clientX;
                touchY = e.touches[0].clientY;
            });

            document.addEventListener("touchend", () => {
                isTouching = false;
            });
        }

        /* ------------------------ PLANET INFO ------------------------ */

        function updatePlanetInfo() {
            raycaster.setFromCamera({ x: 0, y: 0 }, camera);

            const objs = planets.map(p => p.mesh).concat(sun);
            const hits = raycaster.intersectObjects(objs);

            const panel = document.getElementById("planet-info");

            if (hits.length > 0) {
                const obj = hits[0].object;
                const d = obj.userData;

                document.getElementById("planet-name").textContent = d.name;
                document.getElementById("planet-description").textContent = d.description;
                document.getElementById("planet-distance").textContent = "üìç " + d.realDistance;
                document.getElementById("planet-size").textContent = "üåê " + d.realSize;
                document.getElementById("planet-orbital").textContent = "üîÑ " + d.orbitalPeriod;
                document.getElementById("planet-day").textContent = "‚è∞ " + d.dayLength;
                document.getElementById("planet-moons").textContent = "üåô " + d.moons;
                document.getElementById("planet-curiosity").textContent = d.curiosity;

                panel.style.display = "block";

                if (planetInfoTimer) clearTimeout(planetInfoTimer);

            } else {
                if (!planetInfoTimer) {
                    planetInfoTimer = setTimeout(() => {
                        document.getElementById("planet-info").style.display = "none";
                        planetInfoTimer = null;
                    }, 2500);
                }
            }
        }

        /* ------------------------ ANIMATION ------------------------ */

        function animate() {
            renderer.setAnimationLoop(render);
        }

        function render() {
            planets.forEach(p => {
                p.angle += p.speed;
                p.mesh.position.x = Math.cos(p.angle) * p.distance;
                p.mesh.position.z = Math.sin(p.angle) * p.distance;
            });

            if (isVRMode) updatePlanetInfo();

            renderer.render(scene, camera);
        }

        function onResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
    </script>
</body>
</html>
